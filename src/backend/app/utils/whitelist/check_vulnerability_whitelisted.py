from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import func, and_
from sqlalchemy.future import select
from app.modules.vulnerability.models.vulnerability_model import Vulnerability as Vulnerabilities

async def check_vulnerabilities_whitelisted(db: AsyncSession, pr_scan_id: int) -> bool:
    query = select(func.count()).select_from(Vulnerabilities).where(
        and_(Vulnerabilities.pr_scan_id == pr_scan_id, Vulnerabilities.whitelisted == False)
    )
    result = await db.scalar(query)
    return result == 0
