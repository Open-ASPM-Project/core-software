from alembic import op
import sqlalchemy as sa
from datetime import datetime
from typing import Sequence, Union


# revision identifiers, used by Alembic.
revision = '1735291973'
down_revision = '6af7a5ce8406'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None

def upgrade():
    # Add new columns to the vulnerability table
    op.add_column('vulnerability', sa.Column('score_raw', sa.Float(), nullable=True))
    op.add_column('vulnerability', sa.Column('score_normalized', sa.Float(), nullable=True))
    op.add_column(
        'vulnerability',
        sa.Column('score_normalized_on', sa.DateTime(), default=datetime.utcnow, nullable=True)
    )

def downgrade():
    # Remove the added columns in case of downgrade
    op.drop_column('vulnerability', 'score_raw')
    op.drop_column('vulnerability', 'score_normalized')
    op.drop_column('vulnerability', 'score_normalized_on')
