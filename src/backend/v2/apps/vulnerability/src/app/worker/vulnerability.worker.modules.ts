import { Module } from '@nestjs/common';
import { VulnerabilityWorker } from './vulnerability.worker';
import { VulnerabilityModule } from '../vulnerability/vulnerability.modules';
import { MessagePubSubModule } from '@firewall-backend/message-pub-sub';
import { VulnerabilityWorkerController } from './vulnerability.worker.controller';
import { ConfigurationModule } from '@firewall-backend/configuration';
import { IncidentModule } from '../incident/incident.module';
import { TechDetectionModule } from '../tech-detect/tech-detection.module';
import { AssetAllowlistModule } from '../asset-allowlist/asset-allowlist.module';

@Module({
  imports: [
    MessagePubSubModule.forRoot({
      adapter: 'rabbitmq',
      rabbitUrl: process.env.RABBITMQ_URL,
      rabbitExchange: 'vulnerability-exchange',
      rabbitQueueName: 'vulnerability-queue',
    }),
    VulnerabilityModule,
    ConfigurationModule,
    IncidentModule,
    TechDetectionModule,
    AssetAllowlistModule,
  ],
  controllers: [VulnerabilityWorkerController],
  providers: [VulnerabilityWorker],
  exports: [VulnerabilityWorker],
})
export class VulnerabilityWorkerModule {}
