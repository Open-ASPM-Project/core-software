import { Severity } from '@firewall-backend/enums';
import {
  IsOptional,
  IsInt,
  Min,
  IsEnum,
  IsArray,
  IsString,
  IsBoolean,
  IsDate,
} from 'class-validator';

export enum OrderBy {
  DESC = 'desc',
  ASC = 'asc',
}

export class GetVulnerabilityFilterDto {
  // Pagination
  @IsOptional()
  @IsInt()
  @Min(1)
  page?: number = 1;

  @IsOptional()
  @IsInt()
  @Min(1)
  limit?: number = 10;

  // ------------------------
  // All filterable columns from the entity:
  // ------------------------

  // 1. templateId
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  templateId?: string[];

  // 2. templatePath
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  templatePath?: string[];

  // 3. templateEncoded
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  templateEncoded?: string[];

  // 4. infoName
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  infoName?: string[];

  // 5. infoSeverity
  @IsOptional()
  @IsArray()
  @IsEnum(Severity, { each: true })
  infoSeverity?: Severity[];

  // 6. infoDescription
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  infoDescription?: string[];

  // 7. infoImpact
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  infoImpact?: string[];

  // 8. infoRemediation
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  infoRemediation?: string[];

  // 9. type
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  type?: string[];

  // 10. host
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  host?: string[];

  // 11. port
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  port?: string[];

  // 12. scheme
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  scheme?: string[];

  // 13. url
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  url?: string[];

  // 14. matchedAt
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  matchedAt?: string[];

  // 15. request
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  request?: string[];

  // 16. response
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  response?: string[];

  // 17. ip
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  ip?: string[];

  // 18. timestamp range
  @IsOptional()
  @IsDate()
  timestampStart?: Date;

  @IsOptional()
  @IsDate()
  timestampEnd?: Date;

  // 19. curlCommand
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  curlCommand?: string[];

  // 20. matcherStatus (Boolean array)
  @IsOptional()
  @IsArray()
  @IsBoolean({ each: true })
  matcherStatus?: boolean[];

  // 21. profile
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  profile?: string[];

  // 22. assetName
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  assetName?: string[];

  // 23. assetType
  @IsOptional()
  @IsArray()
  @IsString({ each: true })
  assetType?: string[];

  // Sorting fields
  @IsOptional()
  @IsString()
  sort_by?: string;

  @IsOptional()
  @IsEnum(OrderBy)
  order_by?: OrderBy;
}
